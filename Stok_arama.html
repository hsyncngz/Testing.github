<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GeliÅŸmiÅŸ Barkodlu ÃœrÃ¼n Arama</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; max-width: 1000px; margin: auto; background-color: #f9f9f9; }
    .search-container { display: flex; gap: 10px; margin-bottom: 15px; }
    input[type="text"] { flex: 1; padding: 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 4px; }
    
    /* Kamera Kutusu AyarlarÄ± */
    #scanner-wrapper { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 20px rgba(0,0,0,0.3); width: 90%; max-width: 400px; }
    #reader { width: 100%; }
    .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; }
    
    .btn-scan { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .btn-close { margin-top: 10px; width: 100%; background: #dc3545; color: white; border: none; padding: 8px; border-radius: 4px; }

    table { width: 100%; border-collapse: collapse; background: white; }
    th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
    th { background-color: #007bff; color: white; }
    tr:hover { background-color: #f1f1f1; }
  </style>
</head>
<body>

  <h2>DetaylÄ± ÃœrÃ¼n Arama</h2>
  
  <div class="search-container">
    <input type="text" id="arama" placeholder="ÃœrÃ¼n adÄ±, kodu veya barkod okutun...">
    <button class="btn-scan" onclick="kameraAc()">ðŸ“· Barkod Tara</button>
  </div>

  <div class="overlay" id="overlay" onclick="kameraKapat()"></div>
  <div id="scanner-wrapper">
    <div id="reader"></div>
    <button class="btn-close" onclick="kameraKapat()">Kapat</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>ÃœrÃ¼n Kodu</th>
        <th>ÃœrÃ¼n AdÄ±</th>
        <th>Barkodlar</th>
        <th>Liste FiyatÄ±</th>
        <th>Stok</th>
      </tr>
    </thead>
    <tbody id="liste"></tbody>
  </table>

  <script>
    let urunVerisi = [];
    let html5QrCode;

    // Veriyi Ã§ek
    fetch('https://raw.githubusercontent.com/hsyncngz/Testing.github/main/veri.json')
      .then(res => res.json())
      .then(data => {
        urunVerisi = data;
        tabloyuGuncelle(urunVerisi.slice(0, 1)); // Ä°lk aÃ§Ä±lÄ±ÅŸta ilk satÄ±rÄ± gÃ¶ster
      })
      .catch(err => console.error('Veri yÃ¼klenemedi:', err));

    function tabloyuGuncelle(listeData) {
      const liste = document.getElementById('liste');
      liste.innerHTML = '';
      
      listeData.forEach(item => {
        const tr = document.createElement('tr');
        // Barkod sÃ¼tunlarÄ±nÄ± birleÅŸtirip gÃ¶sterelim
        const barkodlar = [item.barkod1, item.barkod2, item.barkod3].filter(b => b).join(', ');
        
        tr.innerHTML = `
          <td>${item["ÃœrÃ¼n Kodu"] || '-'}</td>
          <td>${item["ÃœrÃ¼n AdÄ±"] || '-'}</td>
          <td style="font-size: 0.85em; color: #666;">${barkodlar}</td>
          <td>${item["Liste FiyatÄ±"] || '-'}</td>
          <td>${item["Stok MiktarÄ±"] || '-'}</td>
        `;
        liste.appendChild(tr);
      });
    }

    function filtrele() {
      const terim = document.getElementById('arama').value.toLowerCase().trim();
      if (!terim) {
        tabloyuGuncelle(urunVerisi.slice(0, 1));
        return;
      }

      const sonuclar = urunVerisi.filter(item => {
        const metin = `${item["ÃœrÃ¼n AdÄ±"]} ${item["ÃœrÃ¼n Kodu"]}`.toLowerCase();
        // BarkodlarÄ± kontrol et
        const barkodEslesti = [item.barkod1, item.barkod2, item.barkod3].some(b => String(b).toLowerCase() === terim);
        const metinEslesti = metin.includes(terim);
        
        // Stok kontrolÃ¼ (opsiyonel: stok > 0 olanlarÄ± getir)
        const stok = parseFloat(String(item["Stok MiktarÄ±"]).replace(',', '.')) || 0;
        
        return (metinEslesti || barkodEslesti) && (terim.length > 2 ? true : true);
      });

      tabloyuGuncelle(sonuclar);
    }

    // Kamera FonksiyonlarÄ±
    function kameraAc() {
      document.getElementById('scanner-wrapper').style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
      
      html5QrCode = new Html5Qrcode("reader");
      html5QrCode.start(
        { facingMode: "environment" }, 
        { fps: 10, qrbox: { width: 250, height: 250 } },
        (decodedText) => {
          // Barkod okunduÄŸunda:
          document.getElementById('arama').value = decodedText;
          kameraKapat();
          filtrele();
        }
      ).catch(err => alert("Kamera baÅŸlatÄ±lamadÄ±: " + err));
    }

    function kameraKapat() {
      if (html5QrCode) {
        html5QrCode.stop().then(() => {
          document.getElementById('scanner-wrapper').style.display = 'none';
          document.getElementById('overlay').style.display = 'none';
        });
      }
    }

    document.getElementById('arama').addEventListener('input', filtrele);
  </script>
</body>
</html>
