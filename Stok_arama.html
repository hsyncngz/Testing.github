<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GeliÅŸmiÅŸ Barkod Arama</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 900px; margin: auto; background: #f4f4f4; }
    .search-area { display: flex; gap: 10px; margin-bottom: 20px; }
    input[type="text"] { flex: 1; padding: 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; }
    
    /* Kamera Kutusu AyarlarÄ± */
    #scanner-wrapper { 
      display: none; position: fixed; top: 50%; left: 50%; 
      transform: translate(-50%, -50%); z-index: 1000; 
      background: white; padding: 10px; border-radius: 10px; 
      box-shadow: 0 0 30px rgba(0,0,0,0.5); width: 320px; 
    }
    
    /* ZORUNLU YAKINLAÅžTIRMA (ZOOM) EFEKTÄ° */
    #reader { 
      width: 100%; 
      overflow: hidden; /* TaÅŸmalarÄ± gizle */
      border-radius: 8px;
    }
    #reader video { 
      transform: scale(1.5); /* %50 Zoom */
      transform-origin: center;
    }

    .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 999; }
    .btn-scan { background: #28a745; color: white; border: none; padding: 0 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
    .btn-close { width: 100%; background: #333; color: white; border: none; padding: 10px; margin-top: 10px; border-radius: 5px; }

    table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    th, td { padding: 12px; border: 1px solid #eee; text-align: left; }
    th { background-color: #007bff; color: white; }
    
    /* Barkod sÃ¼tunu burada gizleniyor */
    .barkod-sutunu { display: none; }
  </style>
</head>
<body>

  <h2>ÃœrÃ¼n Arama & Barkod TarayÄ±cÄ±</h2>
  
  <div class="search-area">
    <input type="text" id="arama" placeholder="ÃœrÃ¼n adÄ±, kodu veya barkod...">
    <button class="btn-scan" onclick="kameraAc()">ðŸ“· TARA</button>
  </div>

  <div class="overlay" id="overlay" onclick="kameraKapat()"></div>
  <div id="scanner-wrapper">
    <div id="reader"></div>
    <button class="btn-close" onclick="kameraKapat()">Ä°PTAL</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>ÃœrÃ¼n Kodu</th>
        <th>ÃœrÃ¼n AdÄ±</th>
        <th>Fiyat</th>
        <th>Stok</th>
        <th class="barkod-sutunu">Barkodlar</th>
      </tr>
    </thead>
    <tbody id="liste"></tbody>
  </table>

  <script>
    let tumVeri = [];
    let qrOkuyucu;

    // Veriyi yÃ¼kle
    fetch('https://raw.githubusercontent.com/hsyncngz/Testing.github/main/veri.json')
      .then(res => res.json())
      .then(data => {
        tumVeri = data;
        tabloCiz(tumVeri.slice(0, 1));
      });

    function tabloCiz(veriler) {
      const liste = document.getElementById('liste');
      liste.innerHTML = '';
      veriler.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item["ÃœrÃ¼n Kodu"] || ''}</td>
          <td>${item["ÃœrÃ¼n AdÄ±"] || ''}</td>
          <td>${item["Liste FiyatÄ±"] || ''}</td>
          <td>${item["Stok MiktarÄ±"] || ''}</td>
          <td class="barkod-sutunu">${item.barkod1 || ''} ${item.barkod2 || ''} ${item.barkod3 || ''}</td>
        `;
        liste.appendChild(tr);
      });
    }

    function ara() {
      const deger = document.getElementById('arama').value.toLowerCase().trim();
      if (!deger) { tabloCiz(tumVeri.slice(0, 1)); return; }

      const sonuc = tumVeri.filter(item => {
        const aramaMetni = `${item["ÃœrÃ¼n AdÄ±"]} ${item["ÃœrÃ¼n Kodu"]}`.toLowerCase();
        // Gizli barkod sÃ¼tunlarÄ±nÄ± kontrol et
        const barkodlar = [String(item.barkod1), String(item.barkod2), String(item.barkod3)];
        const barkodEslesme = barkodlar.some(b => b.toLowerCase() === deger);
        
        return aramaMetni.includes(deger) || barkodEslesme;
      });
      tabloCiz(sonuc);
    }

    function kameraAc() {
      document.getElementById('scanner-wrapper').style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
      
      qrOkuyucu = new Html5Qrcode("reader");
      const config = { 
        fps: 20, 
        qrbox: { width: 200, height: 120 }, // Ä°nce uzun barkod kutusu
        aspectRatio: 1.0 
      };

      qrOkuyucu.start(
        { facingMode: "environment" }, 
        config,
        (text) => {
          document.getElementById('arama').value = text;
          kameraKapat();
          ara(); // Otomatik arama yap
        }
      ).catch(err => console.error(err));
    }

    function kameraKapat() {
      if (qrOkuyucu) {
        qrOkuyucu.stop().then(() => {
          document.getElementById('scanner-wrapper').style.display = 'none';
          document.getElementById('overlay').style.display = 'none';
        });
      }
    }

    document.getElementById('arama').addEventListener('input', ara);
  </script>
</body>
</html>
